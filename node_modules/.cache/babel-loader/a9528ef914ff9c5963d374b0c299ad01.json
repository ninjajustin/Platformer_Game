{"ast":null,"code":"import * as THREE from \"three\";\nimport { ATexture } from \"../ATexture\";\nimport { ShaderManager } from \"./ShaderManager\";\nimport { AMaterialModelBase } from \"./AMaterialModel\";\nimport { AShaderMaterial } from \"./AShaderMaterial\";\nimport { Color } from \"../../math\";\nimport { folder } from \"leva\";\nimport { TextureKeyForName, TextureProvidedKeyForName } from \"../../defines\";\nimport { GetAppState } from \"../../base\";\nfunction getTextureFromFile(file, callback) {\n  let userImageURL = URL.createObjectURL(file);\n  let loader = new THREE.TextureLoader();\n  loader.setCrossOrigin(\"\");\n  loader.load(userImageURL, callback);\n}\nexport class AShaderModelBase extends AMaterialModelBase {\n  constructor() {\n    super(...arguments);\n    this.uniforms = void 0;\n    this.textures = {};\n    this.sharedUniforms = {};\n    this.ShaderMaterialClass = AShaderMaterial;\n    this._shaderSource = void 0;\n    this._shaderSettings = {};\n  }\n  get vertexSource() {\n    return this._shaderSource.vertexSource;\n  }\n  get fragSource() {\n    return this._shaderSource.fragSource;\n  }\n  get settingArgs() {\n    return this._shaderSettings;\n  }\n  get usesLights() {\n    return this.settingArgs['lights'];\n  }\n  get supportsTransparency() {\n    return this.settingArgs['transparent'];\n  }\n  get usesVertexColors() {\n    return this.settingArgs['vertexColors'];\n  }\n  set usesVertexColors(value) {\n    this.settingArgs['vertexColors'] = value;\n  }\n  get rendersWireframe() {\n    return this.settingArgs['wireframe'];\n  }\n\n  // public shaderSourcesLoadedPromise!:Promise<ShaderProgramSource>;\n\n  get sourcesLoadedPromise() {\n    // if(this._shaderSource instanceof Promise<ShaderProgramSource>){\n    //     return this._shaderSource;\n    // }else{\n    return this._shaderSource.sourcesLoadedPromise;\n    // }\n  }\n\n  getTextureGUIParams(material) {\n    let texs = {};\n    for (let t in material.textures) {\n      texs = {\n        ...texs,\n        ...AShaderModelBase.ShaderTextureGUIUpload(material, t)\n      };\n    }\n    return {\n      Textures: folder({\n        ...texs\n      }, {\n        collapsed: false\n      })\n    };\n  }\n  static ShaderUniformGUIColorControl(material, paramKey) {\n    const paramName = paramKey ? paramKey : 'color';\n    let rval = {};\n    rval[paramName] = {\n      value: material.getUniformValue(paramName) ? Color.FromTHREEVector4(material.getUniformValue(paramName)).toHexString() : \"#aaaaaa\",\n      onChange: v => {\n        let selectedColor = Color.FromString(v);\n        material.setUniformColor(paramName, selectedColor);\n      }\n    };\n    return rval;\n  }\n  static ShaderUniformGUIControl(material, paramName, defaultValue, otherSpecs) {\n    let rval = {};\n    rval[paramName] = {\n      value: material.getUniformValue(paramName) ? material.getUniformValue(paramName) : defaultValue,\n      onChange: v => {\n        material.setUniform(paramName, v, 'float');\n      },\n      ...otherSpecs\n    };\n    return rval;\n  }\n  static ShaderTextureGUIUpload(material, paramName, otherSpecs) {\n    let rval = {};\n    rval[TextureKeyForName(paramName)] = {\n      image: undefined,\n      onChange: v => {\n        if (v) {\n          let loader = new THREE.TextureLoader();\n          loader.setCrossOrigin(\"\");\n          loader.load(v, tex => {\n            let atex = new ATexture();\n            atex._setTHREETexture(tex);\n            material.setTexture(paramName, atex);\n          });\n        }\n      }\n    };\n    return rval;\n  }\n\n  // async _setShader(shaderName:string){\n  //     const self = this;\n  //     self._shaderSource= await ShaderManager.GetShaderSource(shaderName);\n  //     return self._shaderSource;\n  // }\n\n  setShader(shaderName) {\n    // this.shaderSourcesLoadedPromise = this._setShader(shaderName);\n    this._shaderSource = ShaderManager.GetShaderSource(shaderName);\n  }\n  setUniformsDict(uniforms) {\n    this.uniforms = uniforms;\n  }\n  setTexture(name, texture) {\n    if (texture) {\n      var _this$getTexture;\n      if (texture instanceof ATexture) {\n        this.textures[name] = texture;\n      } else {\n        this.textures[name] = new ATexture(texture);\n      }\n      this.setUniform(TextureKeyForName(name), (_this$getTexture = this.getTexture(name)) === null || _this$getTexture === void 0 ? void 0 : _this$getTexture.threejs, 't');\n      this.setUniform(TextureProvidedKeyForName(name), !!this.getTexture(name), 'bool');\n    } else if (texture === undefined) {\n      this.textures[name] = texture;\n      this.setUniform(TextureKeyForName(name), null, 't');\n      this.setUniform(TextureProvidedKeyForName(name), false, 'bool');\n    }\n  }\n  getTexture(name) {\n    return this.textures[name];\n  }\n  setUniform(name, value, type) {\n    let uval = {\n      value: value\n    };\n    if (type !== undefined) {\n      uval['type'] = type;\n    }\n    // @ts-ignore\n    this.uniforms[name] = uval;\n  }\n  getUniformValue(name) {\n    let uniform = this.uniforms[name];\n    return uniform === null || uniform === void 0 ? void 0 : uniform.value;\n  }\n  _CreateTHREEJS() {\n    let uniforms = {\n      uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib['lights'], {\n        ...this.uniforms\n      }])\n    };\n    return new this.materialClass({\n      vertexShader: this.vertexSource,\n      fragmentShader: this.fragSource,\n      ...this.settingArgs,\n      ...this.defaults,\n      ...uniforms,\n      ...this.sharedParameters\n    });\n  }\n  CreateMaterial() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    let material = new this.ShaderMaterialClass(...args);\n    material.init(this);\n    return material;\n  }\n}\nexport class AShaderModel extends AShaderModelBase {\n  constructor(shaderName, shaderSettings, uniforms, sharedUniforms) {\n    for (var _len2 = arguments.length, args = new Array(_len2 > 4 ? _len2 - 4 : 0), _key2 = 4; _key2 < _len2; _key2++) {\n      args[_key2 - 4] = arguments[_key2];\n    }\n    super(shaderName, THREE.ShaderMaterial, ...args);\n    this._shaderSettings = shaderSettings !== null && shaderSettings !== void 0 ? shaderSettings : {\n      lights: true,\n      transparent: true,\n      side: THREE.DoubleSide,\n      opacity: 1.0\n    };\n    this.uniforms = uniforms !== null && uniforms !== void 0 ? uniforms : {};\n    this.sharedUniforms = sharedUniforms !== null && sharedUniforms !== void 0 ? sharedUniforms : {};\n    if (shaderName) {\n      this.setShader(shaderName);\n    }\n  }\n  static async ShaderSourceLoaded(shaderName) {\n    let shaderSource = ShaderManager.GetShaderSource(shaderName);\n    if (shaderSource === undefined) {\n      await ShaderManager.LoadShader(shaderName);\n    }\n  }\n  static async CreateModel(shaderName) {\n    if (shaderName === undefined) {\n      throw new Error(\"must provide shader name\");\n    }\n    await AShaderModel.ShaderSourceLoaded(shaderName);\n    for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n      args[_key3 - 1] = arguments[_key3];\n    }\n    return new this(shaderName, ...args);\n  }\n  AddStandardUniforms(mat) {\n    let appState = GetAppState();\n    function checkAppState(name, initialValue, min, max, step) {\n      if (appState.getState(name) === undefined) {\n        appState.addSliderControl(name, initialValue !== null && initialValue !== void 0 ? initialValue : 1.0, min, max, step);\n      }\n    }\n    checkAppState('ambient', 0.15, 0, 2, 0.01);\n    checkAppState('diffuse', 1.0, 0, 3, 0.01);\n    checkAppState('specular', 1.0, 0, 3, 0.01);\n    checkAppState('specularExp', 2.5, 0, 5, 0.1);\n    function setMatUniformFunc(name) {\n      function setu() {\n        mat.setUniform(name, appState.getState(name));\n      }\n      setu();\n      mat.subscribe(appState.addStateValueListener(name, () => {\n        setu();\n      }), `${name}_update`);\n    }\n    setMatUniformFunc('ambient');\n    setMatUniformFunc('diffuse');\n    setMatUniformFunc('specular');\n    setMatUniformFunc('specularExp');\n\n    //\n    // function setAmbient(){\n    //     mat.setUniform('ambient', appState.getState(AAppState.AppStateDefaultKeys.AmbientLight));\n    // }\n    // setAmbient();\n    // mat.subscribe(appState.addStateValueListener(AAppState.AppStateDefaultKeys.AmbientLight, ()=>{\n    //     setAmbient();\n    // }), \"ambient_update\");\n  }\n}","map":{"version":3,"names":["THREE","ATexture","ShaderManager","AMaterialModelBase","AShaderMaterial","Color","folder","TextureKeyForName","TextureProvidedKeyForName","GetAppState","getTextureFromFile","file","callback","userImageURL","URL","createObjectURL","loader","TextureLoader","setCrossOrigin","load","AShaderModelBase","uniforms","textures","sharedUniforms","ShaderMaterialClass","_shaderSource","_shaderSettings","vertexSource","fragSource","settingArgs","usesLights","supportsTransparency","usesVertexColors","value","rendersWireframe","sourcesLoadedPromise","getTextureGUIParams","material","texs","t","ShaderTextureGUIUpload","Textures","collapsed","ShaderUniformGUIColorControl","paramKey","paramName","rval","getUniformValue","FromTHREEVector4","toHexString","onChange","v","selectedColor","FromString","setUniformColor","ShaderUniformGUIControl","defaultValue","otherSpecs","setUniform","image","undefined","tex","atex","_setTHREETexture","setTexture","setShader","shaderName","GetShaderSource","setUniformsDict","name","texture","getTexture","threejs","type","uval","uniform","_CreateTHREEJS","UniformsUtils","merge","UniformsLib","materialClass","vertexShader","fragmentShader","defaults","sharedParameters","CreateMaterial","args","init","AShaderModel","constructor","shaderSettings","ShaderMaterial","lights","transparent","side","DoubleSide","opacity","ShaderSourceLoaded","shaderSource","LoadShader","CreateModel","Error","AddStandardUniforms","mat","appState","checkAppState","initialValue","min","max","step","getState","addSliderControl","setMatUniformFunc","setu","subscribe","addStateValueListener"],"sources":["/Users/home/Desktop/College/Fall 2022/CS_4620/cs4620-final-project/src/anigraph/rendering/material/AShaderModel.ts"],"sourcesContent":["import * as THREE from \"three\";\nimport {IUniform} from \"three\";\nimport {ATexture} from \"../ATexture\";\nimport {ShaderManager, AShaderProgramSource} from \"./ShaderManager\";\nimport {AMaterialModelBase} from \"./AMaterialModel\";\nimport {AShaderMaterial} from \"./AShaderMaterial\";\nimport {ShaderMaterialParameters} from \"three/src/materials/ShaderMaterial\";\nimport {Color} from \"../../math\";\nimport {button, folder} from \"leva\";\nimport {TextureKeyForName, TextureProvidedKeyForName} from \"../../defines\";\nimport {ClassInterface} from \"../../basictypes\";\nimport {GetAppState} from \"../../base\";\n\nexport type ShaderUniformDict = {[name:string]:IUniform<any>};\n\n\nfunction getTextureFromFile(file: File, callback:(texture:THREE.Texture)=>void) {\n    let userImageURL = URL.createObjectURL(file);\n    let loader = new THREE.TextureLoader();\n    loader.setCrossOrigin(\"\");\n    loader.load(userImageURL, callback);\n}\n\n\nexport abstract class AShaderModelBase<ParamInterface extends {[name:string]:any}> extends AMaterialModelBase<ParamInterface>{\n    uniforms!:ShaderUniformDict;\n    public textures:{[name:string]:ATexture|undefined}={};\n    public sharedUniforms:ShaderUniformDict={};\n    ShaderMaterialClass:ClassInterface<AShaderMaterial>=AShaderMaterial;\n\n    protected _shaderSource!:AShaderProgramSource;\n    get vertexSource(){return this._shaderSource.vertexSource;}\n    get fragSource(){return this._shaderSource.fragSource;}\n\n    protected _shaderSettings:ShaderMaterialParameters={};\n    get settingArgs(){return this._shaderSettings;}\n    get usesLights(){return this.settingArgs['lights'];}\n    get supportsTransparency(){return this.settingArgs['transparent'];}\n    get usesVertexColors(){return this.settingArgs['vertexColors'];}\n    set usesVertexColors(value:boolean|undefined){this.settingArgs['vertexColors']=value;}\n    get rendersWireframe(){return this.settingArgs['wireframe'];}\n\n    // public shaderSourcesLoadedPromise!:Promise<ShaderProgramSource>;\n\n\n    get sourcesLoadedPromise(){\n        // if(this._shaderSource instanceof Promise<ShaderProgramSource>){\n        //     return this._shaderSource;\n        // }else{\n            return this._shaderSource.sourcesLoadedPromise;\n        // }\n\n    }\n\n\n\n\n\n    getTextureGUIParams(material:AShaderMaterial) {\n        let texs = {}\n        for(let t in material.textures){\n            texs = {\n                ...texs,\n                ...AShaderModelBase.ShaderTextureGUIUpload(material, t),\n            }\n        }\n        return {\n            Textures: folder({\n                    ...texs\n                },\n                {collapsed: false}\n            ),\n        }\n    }\n\n    static ShaderUniformGUIColorControl(material:AShaderMaterial, paramKey?:string){\n        const paramName = paramKey?paramKey:'color';\n        let rval:{[name:string]:any} = {};\n        rval[paramName] = {\n            value: material.getUniformValue(paramName)?Color.FromTHREEVector4(material.getUniformValue(paramName)).toHexString():\"#aaaaaa\",\n            onChange: (v: string) => {\n                let selectedColor = Color.FromString(v);\n                material.setUniformColor(paramName, selectedColor);\n            },\n        }\n        return rval;\n    }\n\n    static ShaderUniformGUIControl(material:AShaderMaterial, paramName:string, defaultValue:any, otherSpecs:{[name:string]:any}){\n        let rval:{[name:string]:any} = {};\n        rval[paramName] = {\n            value: material.getUniformValue(paramName)?material.getUniformValue(paramName):defaultValue,\n            onChange: (v: string) => {\n                material.setUniform(paramName, v, 'float');\n            },\n            ...otherSpecs\n        }\n        return rval;\n    }\n\n    static ShaderTextureGUIUpload(material:AShaderMaterial, paramName:string, otherSpecs?:{[name:string]:any}){\n        let rval:{[name:string]:any} = {};\n        rval[TextureKeyForName(paramName)] ={\n            image: undefined,\n            onChange:(v:any)=>{\n                if(v) {\n                    let loader = new THREE.TextureLoader();\n                    loader.setCrossOrigin(\"\");\n                    loader.load(v, (tex:THREE.Texture)=>{\n                        let atex = new ATexture();\n                        atex._setTHREETexture(tex);\n                        material.setTexture(paramName, atex);\n                    });\n                }\n            }\n        }\n        return rval;\n    }\n\n\n\n    // async _setShader(shaderName:string){\n    //     const self = this;\n    //     self._shaderSource= await ShaderManager.GetShaderSource(shaderName);\n    //     return self._shaderSource;\n    // }\n\n    setShader(shaderName:string){\n        // this.shaderSourcesLoadedPromise = this._setShader(shaderName);\n        this._shaderSource= ShaderManager.GetShaderSource(shaderName);\n    }\n\n    setUniformsDict(uniforms:ShaderUniformDict){\n        this.uniforms = uniforms;\n    }\n    setTexture(name:string, texture?:ATexture|string){\n        if(texture) {\n            if (texture instanceof ATexture) {\n                this.textures[name] = texture;\n            } else {\n                this.textures[name] = new ATexture(texture);\n            }\n            this.setUniform(TextureKeyForName(name), this.getTexture(name)?.threejs, 't');\n            this.setUniform(TextureProvidedKeyForName(name), !!this.getTexture(name), 'bool');\n        }else if(texture===undefined){\n            this.textures[name] = texture;\n            this.setUniform(TextureKeyForName(name), null, 't');\n            this.setUniform(TextureProvidedKeyForName(name), false, 'bool');\n        }\n    }\n\n    getTexture(name:string){\n        return this.textures[name];\n    }\n\n    setUniform(name:string, value:any, type?:string) {\n        let uval: { [name: string]: any } = {value:value};\n        if (type !== undefined) {\n            uval['type'] = type;\n        }\n        // @ts-ignore\n        this.uniforms[name] = uval;\n    }\n\n    getUniformValue(name:string) {\n        let uniform = this.uniforms[name];\n        return uniform?.value;\n    }\n\n    _CreateTHREEJS(){\n        let uniforms = {uniforms:THREE.UniformsUtils.merge([\n                THREE.UniformsLib['lights'],\n                {...this.uniforms}\n            ])};\n        return new this.materialClass({\n            vertexShader: this.vertexSource,\n            fragmentShader: this.fragSource,\n            ...this.settingArgs,\n            ...this.defaults,\n            ...uniforms,\n            ...this.sharedParameters,\n        });\n    }\n\n    CreateMaterial(...args:any[]){\n        let material =  new this.ShaderMaterialClass(...args);\n        material.init(this);\n        return material;\n    }\n\n}\n\nexport interface CreatesShaderModels{\n    CreateModel(...args:any[]):Promise<AShaderModel>;\n}\n\nexport class AShaderModel extends AShaderModelBase<{[name:string]:any}>{\n    constructor(\n        shaderName?:string,\n        shaderSettings?:ShaderMaterialParameters,\n        uniforms?:ShaderUniformDict,\n        sharedUniforms?:ShaderUniformDict,\n        ...args:any[]\n    ) {\n        super(shaderName, THREE.ShaderMaterial, ...args);\n        this._shaderSettings = shaderSettings??{\n            lights:true,\n            transparent: true,\n            side: THREE.DoubleSide,\n            opacity:1.0\n        };\n        this.uniforms=uniforms??{};\n        this.sharedUniforms=sharedUniforms??{};\n        if(shaderName) {\n            this.setShader(shaderName);\n        }\n    }\n\n\n    static async ShaderSourceLoaded(shaderName:string){\n        let shaderSource = ShaderManager.GetShaderSource(shaderName);\n        if(shaderSource === undefined){\n            await ShaderManager.LoadShader(shaderName);\n        }\n    }\n\n    static async CreateModel(shaderName?:string, ...args:any[]){\n        if(shaderName ===undefined){\n            throw new Error(\"must provide shader name\")\n        }\n        await AShaderModel.ShaderSourceLoaded(shaderName);\n        return new this(shaderName, ...args);\n    }\n\n    AddStandardUniforms(mat:AShaderMaterial){\n        let appState = GetAppState();\n        function checkAppState(name:string, initialValue?:number, min?:number, max?:number, step?:number){\n            if(appState.getState(name)===undefined){\n                appState.addSliderControl(name, initialValue??1.0, min, max, step);\n            }\n        }\n\n        checkAppState('ambient', 0.15, 0, 2, 0.01);\n        checkAppState('diffuse', 1.0, 0, 3, 0.01);\n        checkAppState('specular', 1.0, 0, 3, 0.01);\n        checkAppState('specularExp', 2.5, 0, 5, 0.1);\n\n        function setMatUniformFunc(name:string){\n            function setu(){\n                mat.setUniform(name, appState.getState(name));\n            }\n            setu();\n            mat.subscribe(appState.addStateValueListener(name, ()=>{\n                setu();\n            }), `${name}_update`);\n        }\n\n        setMatUniformFunc('ambient');\n        setMatUniformFunc('diffuse');\n        setMatUniformFunc('specular');\n        setMatUniformFunc('specularExp');\n\n        //\n        // function setAmbient(){\n        //     mat.setUniform('ambient', appState.getState(AAppState.AppStateDefaultKeys.AmbientLight));\n        // }\n        // setAmbient();\n        // mat.subscribe(appState.addStateValueListener(AAppState.AppStateDefaultKeys.AmbientLight, ()=>{\n        //     setAmbient();\n        // }), \"ambient_update\");\n    }\n\n}\n\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}